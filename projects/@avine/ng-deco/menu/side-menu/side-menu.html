@let data = _data();

@if (data.level === 0) {
  <div style="text-align: end">
    @if (state.expanded().size) {
      <button matButton (click)="state.collapseAll()">
        Collapse all
        <mat-icon iconPositionEnd>indeterminate_check_box</mat-icon>
      </button>
    } @else {
      <button matButton (click)="state.expandAll()">
        Expand all
        <mat-icon iconPositionEnd>add_box</mat-icon>
      </button>
    }
  </div>
}

<ul
  class="dc-side-menu__ul"
  [style.--dc-side-menu-level]="data.level"
  [attr.role]="data.level === 0 ? 'navigation' : null"
  [attr.id]="data.id"
>
  @for (item of items(); track $index) {
    <li class="dc-side-menu__li">
      @if (isMenuItem.children(item)) {
        @let id = state.getId(item);

        <button
          matRipple
          type="button"
          class="dc-side-menu__item dc-side-menu__item--parent"
          [aria-expanded]="state.expanded().has(item)"
          [aria-controls]="id"
          (click)="state.toggle(item)"
        >
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />

          <mat-icon class="dc-side-menu__chevron">
            {{ state.expanded().has(item) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>

        <dc-side-menu
          [class.dc-side-menu--hidden]="!state.expanded().has(item)"
          [items]="item.children"
          [_data]="{ level: data.level + 1, id }"
          (activeMenuItem)="state.toggle(item, true); activeMenuItem.emit($event)"
        />
      } @else if (isMenuItem.routerLink(item)) {
        <a
          matRipple
          class="dc-side-menu__item"
          routerLinkActive="dc-side-menu__item--active"
          [routerLinkActiveOptions]="item.routerLinkActiveOptions ?? { exact: false }"
          [routerLink]="item.routerLink"
          [queryParams]="item.queryParams"
          (isActiveChange)="$event ? activeMenuItem.emit(item) : null"
        >
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </a>
      } @else if (isMenuItem.href(item)) {
        <a matRipple class="dc-side-menu__item" [href]="item.href" [attr.target]="item.target">
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </a>
      } @else if (isMenuItem.command(item)) {
        <button matRipple type="button" class="dc-side-menu__item" (click)="item.command()">
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </button>
      }
    </li>
  }
</ul>

<ng-template #itemTmpl let-item>
  @if (item.icon) {
    <mat-icon dcIcon>{{ item.icon }}</mat-icon>
  }
  <span class="dc-side-menu__label">{{ item.label }}</span>
</ng-template>
