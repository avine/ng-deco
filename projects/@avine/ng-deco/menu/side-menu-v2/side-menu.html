<ul class="dc-side-menu__ul" [style.--dc-side-menu-level]="0">
  <ng-container
    [ngTemplateOutlet]="itemsTmpl"
    [ngTemplateOutletContext]="getTemplateContext(items(), 0)"
  />
</ul>

<ng-template dcSideMenuTemplate #itemsTmpl let-items="items" let-level="level">
  @for (item of items; track $index) {
    <li class="dc-side-menu__li">
      @if (isMenuItem.children(item)) {
        @let uid = getUid(item);

        <button
          matRipple
          type="button"
          class="dc-side-menu__item dc-side-menu__item--parent"
          [aria-expanded]="state.expanded().has(item)"
          [aria-controls]="uid"
          (click)="state.toggle(item)"
        >
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />

          <mat-icon class="dc-side-menu__chevron">
            {{ state.expanded().has(item) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>

        <ul
          class="dc-side-menu__ul"
          [class.dc-side-menu__ul--hidden]="!state.expanded().has(item)"
          [style.--dc-side-menu-level]="level + 1"
          [id]="uid"
        >
          <ng-container
            [ngTemplateOutlet]="itemsTmpl"
            [ngTemplateOutletContext]="getTemplateContext(item.children, level + 1)"
          />
        </ul>
      } @else if (isMenuItem.routerLink(item)) {
        <a
          matRipple
          class="dc-side-menu__item"
          routerLinkActive="dc-side-menu__item--active"
          [routerLinkActiveOptions]="item.routerLinkActiveOptions ?? { exact: false }"
          [routerLink]="item.routerLink"
          [queryParams]="item.queryParams"
        >
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </a>
      } @else if (isMenuItem.href(item)) {
        <a matRipple class="dc-side-menu__item" [href]="item.href" [attr.target]="item.target">
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </a>
      } @else if (isMenuItem.command(item)) {
        <button matRipple type="button" class="dc-side-menu__item" (click)="item.command()">
          <ng-container
            [ngTemplateOutlet]="itemTmpl"
            [ngTemplateOutletContext]="{ $implicit: item }"
          />
        </button>
      }
    </li>
  }
</ng-template>

<ng-template #itemTmpl let-item>
  @if (item.icon) {
    <mat-icon dcIcon>{{ item.icon }}</mat-icon>
  }
  <span class="dc-side-menu__label">{{ item.label }}</span>
</ng-template>
